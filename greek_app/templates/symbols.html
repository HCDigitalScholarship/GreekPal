{% extends 'base.html' %}
{% load static %}

    {% block content %}
    <!-- camera modal -->
    <div class="modal" id="CameraModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Edit Symbol</h5>
              <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
             
               
                <div class="camera">
                  <video id="video">Video stream not available.</video>
                  </div>
                  <canvas id="canvas1">
                  </canvas>
        
                  <img style="display:none;" id="photo" alt="The screen capture will appear in this box.">
                    <canvas class="sketchpad border border-dark rounded" id="sketchpad" height="400" width="400"><canvas>
                      
                  
        
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-light" onclick="sketchpad.undo()">
                <svg class="bi bi-arrow-counterclockwise" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M12.83 6.706a5 5 0 0 0-7.103-3.16.5.5 0 1 1-.454-.892A6 6 0 1 1 2.545 5.5a.5.5 0 1 1 .91.417 5 5 0 1 0 9.375.789z"/>
                  <path fill-rule="evenodd" d="M7.854.146a.5.5 0 0 0-.708 0l-2.5 2.5a.5.5 0 0 0 0 .708l2.5 2.5a.5.5 0 1 0 .708-.708L5.707 3 7.854.854a.5.5 0 0 0 0-.708z"/>
                </svg>
              </button>

              <button type="button" class="btn btn-light" onclick="sketchpad.redo()">
                <svg class="bi bi-arrow-clockwise" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M3.17 6.706a5 5 0 0 1 7.103-3.16.5.5 0 1 0 .454-.892A6 6 0 1 0 13.455 5.5a.5.5 0 0 0-.91.417 5 5 0 1 1-9.375.789z"/>
                  <path fill-rule="evenodd" d="M8.147.146a.5.5 0 0 1 .707 0l2.5 2.5a.5.5 0 0 1 0 .708l-2.5 2.5a.5.5 0 1 1-.707-.708L10.293 3 8.147.854a.5.5 0 0 1 0-.708z"/>
                </svg>
              </button>
              <button type="submit" onclick="sketchJSON()" class="btn btn-primary">Edit</button>
            </div>
          </div>
        </div>
      </div>

      <!-- end camera modal -->
     
    
      
    <section style="background-image: linear-gradient(to right, #6a3093, #a044ff);">
        <div class="container">
            
  
  <div class="row py-5">
    <div class="col-lg-12 mx-auto">
      <div class="card rounded shadow border-0">
        <div class="card-body p-8 bg-white rounded">
          <div class="table-responsive">
            <button class="btn btn-light float-right" data-toggle="collapse" data-target="#searchbars">
              <svg class="bi bi-arrows-expand" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M2 8a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 8zm6-1.5a.5.5 0 0 0 .5-.5V1.5a.5.5 0 0 0-1 0V6a.5.5 0 0 0 .5.5z"/>
                <path fill-rule="evenodd" d="M10.354 3.854a.5.5 0 0 0 0-.708l-2-2a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L8 2.207l1.646 1.647a.5.5 0 0 0 .708 0zM8 9.5a.5.5 0 0 1 .5.5v4.5a.5.5 0 0 1-1 0V10a.5.5 0 0 1 .5-.5z"/>
                <path fill-rule="evenodd" d="M10.354 12.146a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L8 13.793l1.646-1.647a.5.5 0 0 1 .708 0z"/>
              </svg>
            </button>
           
<div id="searchbars" class="collapse">
            <table cellpadding="3" cellspacing="0" border="0" style="width: 67%; margin: 0 auto 2em auto;">
              <thead>
                  <tr>
                      <th></th>
                      <th>Search</th>
                     
                  </tr>
              </thead>
              <tbody>
                <!-- src https://datatables.net/examples/api/regex.html -->
                 
                 
                  <tr id="filter_col2" data-column="1">
                      <td>Base Expansion</td>
                      <td align="center"><input type="text" class="column_filter" id="col1_filter"></td>
                    
                  </tr>
                  <tr id="filter_col3" data-column="2">
                      <td>Transcription</td>
                      <td align="center"><input type="text" class="column_filter" id="col2_filter"></td>
                      
                  </tr>
                  <tr id="filter_col4" data-column="3">
                      <td>Type</td>
                      <td align="center"><input type="text" class="column_filter" id="col3_filter"></td>
                      
                  </tr>
                  <tr id="filter_col5" data-column="4">
                      <td>Text</td>
                      <td align="center"><input type="text" class="column_filter" id="col4_filter"></td>
                     
                  </tr>
                  <tr id="filter_col6" data-column="5">
                      <td>Date</td>
                      <td align="center"><input type="text" class="column_filter" id="col5_filter"></td>
                     
                  </tr>
                  <tr id="filter_col7" data-column="6">
                    <td>Place</td>
                    <td align="center"><input type="text" class="column_filter" id="col6_filter"></td>
                   
                </tr>
                <tr id="filter_col8" data-column="7">
                  <td>Scribe</td>
                  <td align="center"><input type="text" class="column_filter" id="col7_filter"></td>
                 
              </tr>
              <tr id="filter_col9" data-column="8">
                <td>Manuscript</td>
                <td align="center"><input type="text" class="column_filter" id="col8_filter"></td>
               
            </tr>
              </tbody>
          </table>
        </div>

            <table id="symboltable" style="width:100%" class="table table-striped table-bordered">
               <thead>
            <tr>
              <th></th>
              <th>Base Expansion</th>
              <th>Transcription</th>
              <th>Type</th>
              <th>Text</th>
              <th>Date</th>
              <th>Place</th>
              <th>Scribe</th>
              <th>Manuscript</th>
            </tr>
          </thead>
                 
         
          <tbody>

            {% for symbol in symbols %}
            
                          <tr>
                             <td><img onclick="edit_symbol(this)" src="{% static symbol.image.name  %}"></td>
                            
                            <td>{{ symbol.base_expansion|default_if_none:"" }}</td>
                          <td>{{ symbol.transcription|default_if_none:"" }}</td>
                          <td>{{ symbol.type|default_if_none:"" }}</td>
                            <td>{{ symbol.text|default_if_none:"" }}</td>
                          <td>{{ symbol.date|default_if_none:"" }}</td>
                          <td>{{ symbol.place|default_if_none:"" }}</td>
                          <td>{{ symbol.scribe|default_if_none:"" }}</td>
                          <td>{{ symbol.manuscript|default_if_none:"" }}</td>
                          </tr>
                      {% endfor %}
            
            
                      </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    </section>
   {% endblock %}
  {% block extrajs %}
    <script src="{% static '/js/jquery.min.js' %}"></script>
    <script src="{% static '/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <script src="{% static '/js/Bootstrap-DataTables.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/pikaday.min.js"></script>
    <script src="{% static '/js/theme.js' %}"></script>
    <script src="{% static '/js/capture.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sketchpad/0.1.0/scripts/sketchpad.js"></script>
    <script src="{% static '/js/diacritics.js' %}"></script>
    <script>
       
        function edit_symbol(e){
            console.log(e.src)
            sketchpad = document.getElementById('sketchpad');
            //sketchpad.setAttribute('width', width);
            //sketchpad.setAttribute('height', height);
            sketchpad.style.backgroundImage = "url(" + e.src + ")";
            sketchpad.style.backgroundSize = "400px";
            $('#CameraModal').modal('toggle');
        };
    </script>
    <script>
      var sketchpad = new Sketchpad({
        element: '#sketchpad',
        width: 400,
        height: 400
      });
      sketchpad.penSize = 10;
      
      function sketchJSON(){
        data = sketchpad.toJSON();
        $.ajax({
          url : "/",
          type: "POST",
          data : {'data': data, 'csrfmiddlewaretoken': '{{ csrf_token }}',},
          dataType : "json",
    
    
        });
      };
    </script>
    <script>
function filterColumn ( i ) {
    $('#symboltable').DataTable().column( i ).search(
        $('#col'+i+'_filter').val(),
    ).draw();
}
       
           // Setup - add a text input to each footer cell
           $('#symboltable thead tr').clone(true).appendTo( '#symboltable thead' );
           $('#symboltable thead tr:eq(1) th').each( function (i) {
               var title = $(this).text();
              //  $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
       
               $( 'input', this ).on( 'keyup change', function () {
                   if ( table.column(i).search() !== this.value ) {
                       table
                           .column(i)
                           .search( this.value )
                           .draw();
                   }
               } );
           } );
       
          
 
    $('input.column_filter').on( 'keyup click', function () {
        filterColumn( $(this).parents('tr').attr('data-column') );
    } );

           var table = $('#symboltable').DataTable( {
            
       
           } );
       
           $("#symboltable thead th").each( function ( i ) {
               if (i>=1){
               var select = $('<select><option value=""></option></select>')
                   .appendTo( $(this).empty() )
                   .on( 'change', function () {
                       table.column( i )
                           .search( $(this).val() )
                           .draw();
                   } );
       
               table.column( i ).data().unique().sort().each( function ( d, j ) {
                   select.append( '<option value="'+d+'">'+d+'</option>' )
               } );
            }
           } );
       
               

              
       </script>
   {% endblock %}
